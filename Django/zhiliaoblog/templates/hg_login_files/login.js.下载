$(document).ready(function() {
	//载入底部版權信息
	$("#bottom").load("../comm/bottom.html?v=20180802");
	
	//**捕捉用户名输入框的回车事件，跳转到密码输入框**/
	$('#dldm').keydown(function(event){
		if(event.keyCode == 13) {
			$('#dlmm').focus();
		}
	});
	
	//**捕捉密码输入框的回车事件，提交表单**/
	$('#dlmm').keydown(function(event){
		if(event.keyCode == 13) {
			$('#btn-login').click();
		}
	});
	
	$("#dldm").focus();  //页面载入时登录代码获得焦点
	
	//判断浏览器版本
	if($.browser.msie) {
		if ($.browser.version == '6.0' || $.browser.version == '7.0' || $.browser.version == '8.0'  || $.browser.version == '9.0') {
			$("#btn-login").attr("disabled",true);
			$("#browse_tips").show()
		}
	}
	
	//点击登录按钮
	$("#btn-login").on("click",function(){
		if ($("#dldm").val() == "") {
			$.messager.alert("提示","请输入登录名","info",function(){
				$("#dldm").focus();
			});
			return false;
		}
		if ($("#dlmm").val() == "") {
			$.messager.alert("提示","请输入登录密码","info",function(){
				$("#dlmm").focus();
			});
			return false;
		}
		$('#form1').form('submit',{
			url:'admin_login_check.action',
			onSubmit: function(){
				showMask();
			},
			success:function(data){
				var _data = $.parseJSON(data);
				if (_data.success) {
					var fromURL = $.query.get("from");
					if (fromURL != "") {
						location.href = unescape(fromURL);
					}
					else {
						location.href = 'index.html?v=20200116';
					}
				}
				else {
					hideMask();
					$.messager.alert('提示',unescape(_data.errors),'error');
				}
			}
		});	
	});
	
	/**显示遮罩层*/
	window.showMask = function(){
		if ($("#public-dialog-mask").length == 0) {
			var _dialog = "<div id='public-dialog-mask' style='width:300px;height:120px;padding:0px; line-height:22px; overflow:hidden;'>";
			_dialog += "<div style='text-align:center; padding-top:20px; overflow:hidden;'><span class='fa fa-spinner fa-pulse'></span> 数据处理中，请稍候...</div>";
			_dialog += "</div>";
			$("body").append(_dialog);
			$("#public-dialog-mask").dialog({
				title:'提示', 
				closed:true, 
				collapsible:false, 
				maximizable:false, 
				minimizable:false, 
				resizable:false, 
				closable:false, 
				modal:true
			});
		}
		$("#public-dialog-mask").dialog("open");
	}
	
	/**关闭遮罩层*/
	window.hideMask = function(){
		if ($("#public-dialog-mask").length > 0) {
			$("#public-dialog-mask").dialog("close");
		}
	}
});